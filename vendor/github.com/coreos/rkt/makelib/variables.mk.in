# @configure_input@

# install scripts
INSTALL = @INSTALL@

# binaries we need to build things
GO := @GOBINARY@
GOFMT := @GOFMTBINARY@
GIT := @GIT@
BASH := @BASH_SHELL@
BASH_SHELL := @BASH_SHELL@
ABS_GO := @ABS_GO@

# path to rkt source code distro
ORG_PATH := github.com/coreos
REPO_PATH := $(ORG_PATH)/rkt

# [STAGE1] build settings

# selinux tags for rkt and functional tests
RKT_TAGS := -tags "selinux @TPM_TAGS@"
# stage1 build mode

RKT_VERSION := @RKT_VERSION@
RKT_STAGE1_VERSION_OVERRIDE := @RKT_STAGE1_FLAVORS_VERSION_OVERRIDE@

RKT_STAGE1_DEFAULT_NAME := @RKT_STAGE1_DEFAULT_NAME@
RKT_STAGE1_DEFAULT_VERSION := @RKT_STAGE1_DEFAULT_VERSION@

RKT_STAGE1_ALL_FLAVORS := @RKT_STAGE1_ALL_FLAVORS@
RKT_STAGE1_FLAVORS := @RKT_STAGE1_FLAVORS@
RKT_STAGE1_DEFAULT_FLAVOR := @RKT_STAGE1_DEFAULT_FLAVOR@

RKT_STAGE1_DEFAULT_LOCATION := @RKT_STAGE1_DEFAULT_LOCATION@
RKT_STAGE1_DEFAULT_IMAGES_DIR := @RKT_STAGE1_DEFAULT_IMAGES_DIR@
RKT_STAGE1_DEFAULT_IMAGE_FILENAME_IN_RKT_DIRECTORY := @RKT_STAGE1_DEFAULT_IMAGE_FILENAME_IN_RKT_DIRECTORY@

RKT_STAGE1_SYSTEMD_SRC := @RKT_STAGE1_SYSTEMD_SRC@
RKT_STAGE1_SYSTEMD_VER := @RKT_STAGE1_SYSTEMD_VER@

RKT_LOCAL_COREOS_PXE_IMAGE_PATH := @RKT_LOCAL_COREOS_PXE_IMAGE_PATH@
RKT_LOCAL_COREOS_PXE_IMAGE_SYSTEMD_VER := @RKT_LOCAL_COREOS_PXE_IMAGE_SYSTEMD_VER@
# defines for enter
RKT_DEFINES_FOR_ENTER := @RKT_DEFINES_FOR_ENTER@

RKT_RUN_FUNCTIONAL_TESTS := @RKT_RUN_FUNCTIONAL_TESTS@

GOARCH_FOR_BUILD := @GOARCH_FOR_BUILD@

RKT_STAGE1_DEFAULT_NAME_LDFLAGS := @RKT_STAGE1_DEFAULT_NAME_LDFLAGS@
RKT_STAGE1_DEFAULT_VERSION_LDFLAGS := @RKT_STAGE1_DEFAULT_VERSION_LDFLAGS@
RKT_STAGE1_DEFAULT_LOCATION_LDFLAGS := @RKT_STAGE1_DEFAULT_LOCATION_LDFLAGS@
RKT_STAGE1_DEFAULT_IMAGE_FILENAME_LDFLAGS := @RKT_STAGE1_DEFAULT_IMAGE_FILENAME_LDFLAGS@
RKT_STAGE1_DEFAULT_IMAGES_DIRECTORY_LDFLAGS := @RKT_STAGE1_DEFAULT_IMAGES_DIRECTORY_LDFLAGS@
RKT_VERSION_LDFLAGS := @RKT_VERSION_LDFLAGS@
RKT_FEATURES_LDFLAGS := @RKT_FEATURES_LDFLAGS@

# build-related directories and binaries
BUILDDIR ?= $(MK_TOPLEVEL_ABS_SRCDIR)/build-@PACKAGE_TARNAME@-@PACKAGE_VERSION@
override BUILDDIR := $(abspath $(BUILDDIR))

MAKETOOLSDIR := $(MK_TOPLEVEL_SRCDIR)/tools
STAMPSDIR := $(BUILDDIR)/stamps
TOOLSDIR := $(BUILDDIR)/tools
BINDIR := $(BUILDDIR)/bin
GOPATH_TO_CREATE := $(BUILDDIR)/gopath
GOPATH := $(GOPATH_TO_CREATE)/src/github.com/coreos/rkt/Godeps/_workspace:$(GOPATH_TO_CREATE)
DEPSDIR := $(BUILDDIR)/deps
FILELISTDIR := $(BUILDDIR)/filelists
MAINTEMPDIR := $(BUILDDIR)/tmp
CLEANDIR := $(BUILDDIR)/clean

ACTOOL := $(BINDIR)/actool
DEPSGENTOOL := $(TOOLSDIR)/depsgen
FILELISTGENTOOL := $(TOOLSDIR)/filelistgen
CLEANGENTOOL := $(TOOLSDIR)/cleangen
QUICKRMTOOL := $(TOOLSDIR)/quickrm

# test-related variables
GO_TEST_PACKAGES ?= ./...
GO_TEST_FUNC_ARGS ?=

GO_ENV := $(strip GOPATH="$(GOPATH)" $(if $(strip $(GOROOT)),GOROOT=$(strip $(GOROOT))))

CREATE_DIRS += \
	$(BUILDDIR) \
	$(STAMPSDIR) \
	$(TOOLSDIR) \
	$(BINDIR) \
	$(GOPATH_TO_CREATE) \
	$(DEPSDIR) \
	$(FILELISTDIR) \
	$(MAINTEMPDIR) \
	$(CLEANDIR)
